<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ê±°ë˜ì²˜ ì§€ë„</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      display: flex;
      height: 100vh;
      background: #f2f4f8;
    }

    #map {
      height: 100%;
      width: 50%;
    }

    .sidebar {
      width: 50%;
      display: flex;
      flex-direction: column;
      padding: 16px;
      gap: 16px;
      overflow-y: auto;
    }

    .section {
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
      padding: 16px;
    }

    .cards {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }

    .card {
      flex: 1 1 calc(50% - 12px);
      background: #ffffff;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 12px;
      transition: box-shadow 0.3s;
      cursor: pointer;
    }

    .card.active {
      border: 2px solid #4a90e2;
      background-color: #f0f8ff;
    }

    .card:hover {
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .card h4 {
      margin: 0 0 6px;
      font-size: 1rem;
    }

    .card small {
      color: #666;
    }

    .history ul {
      padding-left: 18px;
      margin: 0;
    }

    .history li {
      margin-bottom: 6px;
    }

    .leaflet-interactive.hide-circle {
      opacity: 0 !important;
    }

    .leaflet-interactive:focus {
      outline: none;
    }

    .marker-dot {
      width: 14px;
      height: 14px;
      background-color: #ff5e57;
      border: 2px solid white;
      border-radius: 50%;
      box-shadow: 0 0 6px rgba(0, 0, 0, 0.3);
    }

    .marker-bounce {
      animation: bounceMarker 0.6s ease-out;
    }

    @keyframes bounceMarker {
      0% {
        transform: scale(1);
      }

      30% {
        transform: scale(1.4);
      }

      60% {
        transform: scale(0.8);
      }

      100% {
        transform: scale(1);
      }
    }
  </style>
</head>

<body>
  <div id="map"></div>
  <div class="sidebar">
    <div class="section" id="company-list">
      <h3>ğŸ“Œ ê±°ë˜ì²˜ ëª©ë¡</h3>

      <!-- âœ… ì—¬ê¸°ì— ì¶”ê°€ -->
      <div style="display: flex; gap: 8px; margin-bottom: 12px;">
        <input type="text" id="search-input" placeholder="ğŸ” ê±°ë˜ì²˜ ê²€ìƒ‰..."
          style="flex:1; padding: 8px; border-radius: 8px; border: 1px solid #ccc;" />
        <select id="industry-filter" style="padding: 8px; border-radius: 8px; border: 1px solid #ccc;">
          <option value="">ì „ì²´ ì‚°ì—…êµ°</option>
          <option value="ì œì¡°ì—…">ì œì¡°ì—…</option>
          <option value="ì„œë¹„ìŠ¤ì—…">ì„œë¹„ìŠ¤ì—…</option>
          <option value="ITì„œë¹„ìŠ¤">IT</option>
          <option value="í™”í•™">í™”í•™</option>
          <option value="ë°©ì‚°/IT">ë°©ì‚°/IT</option>
          <option value="í”Œë«í¼">í”Œë«í¼</option>
          <option value="í•­ê³µ">í•­ê³µ</option>
        </select>
      </div>

      <div class="cards" id="cards"></div>
    </div>

    <div class="section" id="activity-log">
      <h3>ğŸ“ ì˜ì—… í™œë™</h3>
      <div class="history">
        <ul id="history-list"></ul>
      </div>
    </div>
  </div>


  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <script>
    let selectedCard = null;
    let selectedCircle = null;
    let selectedRegion = null;

    const map = L.map('map').setView([36.5, 127.8], 7);

    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
      attribution: '&copy; OpenStreetMap contributors',

    }).addTo(map);

    const companies = [
      { id: 'COM00001', name: 'í˜„ëŒ€ìë™ì°¨', lat: 37.456, lng: 126.705, region: 'ì„œìš¸íŠ¹ë³„ì‹œ', address: 'ì„œìš¸ ì„œì´ˆêµ¬ í—Œë¦‰ë¡œ 12', industry: 'ì œì¡°ì—…', contact: '02-3456-7890' },
      { id: 'COM00002', name: 'ì‚¼ì„±SDI', lat: 37.275, lng: 127.045, region: 'ê²½ê¸°ë„', address: 'ê²½ê¸° ìš©ì¸ì‹œ ê¸°í¥êµ¬ ì‚¼ì„±ë¡œ 150', industry: 'ì œì¡°ì—…', contact: '031-9876-1234' },
      { id: 'COM00003', name: 'ì¹´ì¹´ì˜¤', lat: 37.402, lng: 127.108, region: 'ê²½ê¸°ë„', address: 'ê²½ê¸° ì„±ë‚¨ì‹œ ë¶„ë‹¹êµ¬ íŒêµì—­ë¡œ 235', industry: 'ITì„œë¹„ìŠ¤', contact: '031-1234-5678' },
      { id: 'COM00004', name: 'ë„¤ì´ë²„', lat: 37.359, lng: 127.105, region: 'ê²½ê¸°ë„', address: 'ê²½ê¸° ì„±ë‚¨ì‹œ ë¶„ë‹¹êµ¬ ì •ìë™ 178-1', industry: 'ITì„œë¹„ìŠ¤', contact: '031-5678-1234' },
      { id: 'COM00005', name: 'LGí™”í•™', lat: 36.350, lng: 127.384, region: 'ëŒ€ì „ê´‘ì—­ì‹œ', address: 'ëŒ€ì „ ìœ ì„±êµ¬ ë¬¸ì§€ë¡œ 300', industry: 'í™”í•™', contact: '042-123-4567' },
      { id: 'COM00006', name: 'í•œí™”ì‹œìŠ¤í…œ', lat: 37.553, lng: 126.972, region: 'ì„œìš¸íŠ¹ë³„ì‹œ', address: 'ì„œìš¸ ì¤‘êµ¬ ì¥êµë™ 1', industry: 'ë°©ì‚°/IT', contact: '02-2222-2222' },
      { id: 'COM00007', name: 'ìš°ì•„í•œí˜•ì œë“¤', lat: 37.497, lng: 127.028, region: 'ì„œìš¸íŠ¹ë³„ì‹œ', address: 'ì„œìš¸ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 152', industry: 'í”Œë«í¼', contact: '02-3333-4444' },
      { id: 'COM00008', name: 'NHN', lat: 37.344, lng: 127.106, region: 'ê²½ê¸°ë„', address: 'ê²½ê¸° ì„±ë‚¨ì‹œ ë¶„ë‹¹êµ¬ ì‚¼í‰ë™', industry: 'ITì„œë¹„ìŠ¤', contact: '031-456-7890' },
      { id: 'COM00009', name: 'ì œì£¼í•­ê³µ', lat: 33.510, lng: 126.491, region: 'ì œì£¼íŠ¹ë³„ìì¹˜ë„', address: 'ì œì£¼ ì œì£¼ì‹œ ì¤‘ì•™ë¡œ 123', industry: 'í•­ê³µ', contact: '064-789-4561' },
      { id: 'COM00010', name: 'ë¶€ì‚°ì€í–‰', lat: 35.179, lng: 129.075, region: 'ë¶€ì‚°ê´‘ì—­ì‹œ', address: 'ë¶€ì‚° ì¤‘êµ¬ ì¤‘ì•™ëŒ€ë¡œ 100', industry: 'ê¸ˆìœµ', contact: '051-888-0000' },
      { id: 'COM00011', name: 'í•œêµ­ì „ë ¥', lat: 35.159, lng: 126.852, region: 'ê´‘ì£¼ê´‘ì—­ì‹œ', address: 'ê´‘ì£¼ ì„œêµ¬ ìƒë¬´ì¤‘ì•™ë¡œ 120', industry: 'ì—ë„ˆì§€', contact: '062-111-2222' },
      { id: 'COM00012', name: 'ì…€íŠ¸ë¦¬ì˜¨', lat: 37.533, lng: 126.896, region: 'ì„œìš¸íŠ¹ë³„ì‹œ', address: 'ì„œìš¸ ì˜ë“±í¬êµ¬ ì—¬ì˜ëŒ€ë¡œ 24', industry: 'ë°”ì´ì˜¤', contact: '02-444-7777' },
      { id: 'COM00013', name: 'ì—ì½”í”„ë¡œ', lat: 36.389, lng: 127.438, region: 'ì¶©ì²­ë¶ë„', address: 'ì¶©ë¶ ì²­ì£¼ì‹œ í¥ë•êµ¬ ë´‰ëª…ë™', industry: 'ì†Œì¬', contact: '043-765-4321' },
      { id: 'COM00014', name: 'ë”ì¡´ë¹„ì¦ˆì˜¨', lat: 37.656, lng: 127.061, region: 'ì„œìš¸íŠ¹ë³„ì‹œ', address: 'ì„œìš¸ ë„ë´‰êµ¬ ìŒë¬¸ë™', industry: 'ERP', contact: '02-8888-9999' },
      { id: 'COM00015', name: 'KT&G', lat: 36.487, lng: 127.283, region: 'ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ', address: 'ì„¸ì¢…ì‹œ ì¡°ì¹˜ì›ì ì„¸ì¢…ë¡œ 123', industry: 'ì œì¡°ì—…', contact: '044-111-2222' },
      { id: 'COM00016', name: 'ë‘ì‚°ì¤‘ê³µì—…', lat: 35.181, lng: 129.072, region: 'ë¶€ì‚°ê´‘ì—­ì‹œ', address: 'ë¶€ì‚° ê¸°ì¥êµ° ì¥ì•ˆì', industry: 'ì¤‘ê³µì—…', contact: '051-4321-1234' },
      { id: 'COM00017', name: 'í¬ìŠ¤ì½”', lat: 35.534, lng: 129.308, region: 'ìš¸ì‚°ê´‘ì—­ì‹œ', address: 'ìš¸ì‚° ë™êµ¬ ë°©ì–´ì§„ìˆœí™˜ë„ë¡œ 1000', industry: 'ì œì¡°ì—…', contact: '052-333-1234' },
      { id: 'COM00018', name: 'ë¡¯ë°ì¼€ë¯¸ì¹¼', lat: 35.213, lng: 128.681, region: 'ê²½ìƒë‚¨ë„', address: 'ê²½ë‚¨ ì°½ì›ì‹œ ì˜ì°½êµ¬ ì¤‘ì•™ëŒ€ë¡œ 100', industry: 'í™”í•™', contact: '055-567-9876' },
      { id: 'COM00019', name: 'ëŒ€ìš°ê±´ì„¤', lat: 37.563, lng: 126.982, region: 'ì„œìš¸íŠ¹ë³„ì‹œ', address: 'ì„œìš¸ ì¢…ë¡œêµ¬ ìˆ˜ì†¡ë™', industry: 'ê±´ì„¤ì—…', contact: '02-2323-1212' },
      { id: 'COM00020', name: 'í˜„ëŒ€ì œì² ', lat: 36.012, lng: 129.365, region: 'ê²½ìƒë¶ë„', address: 'ê²½ë¶ í¬í•­ì‹œ ë‚¨êµ¬', industry: 'ì² ê°•', contact: '054-123-4567' }
    ];


    // const activities = {
    //   'COM00001': ['2024-12-01 ë°©ë¬¸ìƒë‹´', '2025-01-10 ê³„ì•½í˜‘ì˜'],
    //   'COM00002': ['2025-03-20 í˜„ì¥ë¯¸íŒ…'],
    //   'COM00003': ['2025-02-15 ê¸°ìˆ ì§€ì› ìš”ì²­', '2025-03-01 ê³„ì•½ì²´ê²°']
    // };

    const activities = {
      'COM00001': [
        { type: 'ëŒ€ë©´', date: '2025-01-03', content: 'ì œí’ˆ ì‹œì—° ë° ìƒë‹´' },
        { type: 'ì´ë©”ì¼', date: '2025-01-08', content: 'ì œì•ˆì„œ ì†¡ë¶€' }
      ],
      'COM00002': [
        { type: 'ìœ ì„ ', date: '2025-02-12', content: 'ë‚©ê¸° ì¼ì • í™•ì¸' }
      ],
      'COM00003': [
        { type: 'ëŒ€ë©´', date: '2025-01-20', content: 'ê¸°ìˆ  ë¯¸íŒ…' },
        { type: 'ì´ë©”ì¼', date: '2025-01-21', content: 'íšŒì˜ë¡ ì „ë‹¬' }
      ],
      'COM00005': [
        { type: 'ëŒ€ë©´', date: '2025-02-01', content: 'í˜„ì¥ ë°©ë¬¸ ë° ì§€ì› ê²€í† ' },
        { type: 'ìœ ì„ ', date: '2025-02-02', content: 'ê²°ì •ì‚¬í•­ ì „ë‹¬' }
      ],
      'COM00007': [
        { type: 'ëŒ€ë©´', date: '2025-02-10', content: 'ì„œë¹„ìŠ¤ í˜‘ì˜' }
      ],
      'COM00010': [
        { type: 'ì´ë©”ì¼', date: '2025-02-15', content: 'ê³„ì•½ì„œ ì†¡ë¶€' }
      ],
      'COM00014': [
        { type: 'ìœ ì„ ', date: '2025-03-01', content: 'ê¸°ëŠ¥ ë¬¸ì˜' },
        { type: 'ì´ë©”ì¼', date: '2025-03-02', content: 'ìë£Œ ìš”ì²­ íšŒì‹ ' }
      ]
    };

    // const geoRegions = {
    //   "ì„œìš¸íŠ¹ë³„ì‹œ": [[37.5665, 126.9780]],
    //   "ê²½ê¸°ë„": [[37.2636, 127.0286]],
    //   "ê°•ì›ë„": [[37.8228, 128.1555]],
    //   "ì¶©ì²­ë‚¨ë„": [[36.5184, 126.8000]],
    //   "ì¶©ì²­ë¶ë„": [[36.6357, 127.4917]],
    //   "ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ": [[36.4801, 127.2890]],
    //   "ëŒ€ì „ê´‘ì—­ì‹œ": [[36.3504, 127.3845]],
    //   "ì¸ì²œê´‘ì—­ì‹œ": [[37.4563, 126.7052]],
    //   "ê´‘ì£¼ê´‘ì—­ì‹œ": [[35.1595, 126.8526]],
    //   "ëŒ€êµ¬ê´‘ì—­ì‹œ": [[35.8722, 128.6025]],
    //   "ë¶€ì‚°ê´‘ì—­ì‹œ": [[35.1796, 129.0756]],
    //   "ìš¸ì‚°ê´‘ì—­ì‹œ": [[35.5384, 129.3114]],
    //   "ì „ë¼ë¶ë„": [[35.7167, 127.1442]],
    //   "ì „ë¼ë‚¨ë„": [[34.8161, 126.4630]],
    //   "ê²½ìƒë¶ë„": [[36.4919, 128.8889]],
    //   "ê²½ìƒë‚¨ë„": [[35.4606, 128.2132]],
    //   "ì œì£¼íŠ¹ë³„ìì¹˜ë„": [[33.4996, 126.5312]]
    // };

    // for (const [region, coords] of Object.entries(geoRegions)) {
    //   const circle = L.circle(coords[0], {
    //     color: '#666',
    //     fillColor: '#a1c4fd',
    //     fillOpacity: 0.3,
    //     radius: 25000
    //   }).addTo(map).on('click', () => {
    //     showCompanies(region);

    //     if (selectedCircle) {
    //       selectedCircle.setStyle({ color: '#666', fillOpacity: 0.3 });
    //     }

    //     circle.setStyle({ color: '#4a90e2', fillOpacity: 0.5 });
    //     selectedCircle = circle;
    //   }).bindTooltip(region);
    // }

    // ì„œìš¸, ê²½ê¸° ë“± 17ê°œ ì‹œë„ì˜ ê²½ê³„ê°€ ë‹´ê¸´ GeoJSON íŒŒì¼
    fetch('TL_SCCO_CTPRVN.json')
      .then(res => res.json())
      .then(data => {
        L.geoJSON(data, {
          style: {
            color: '#888',
            weight: 1,
            fillColor: '#a1c4fd',
            fillOpacity: 0.3
          },
          onEachFeature: function (feature, layer) {
            const region = feature.properties?.CTP_KOR_NM || "ì•Œ ìˆ˜ ì—†ìŒ";
            layer.on('click', function () {
              showCompanies(region); // ê±°ë˜ì²˜ í•„í„°ë§ í˜¸ì¶œ

              // ì´ì „ ì„ íƒ í•´ì œ
              if (selectedRegion) {
                selectedRegion.setStyle({
                  color: '#888',
                  fillColor: '#a1c4fd',
                  fillOpacity: 0.3,
                  weight: 1
                });
              }

              // ì„ íƒëœ ì˜ì—­ ê°•ì¡°
              layer.setStyle({
                color: '#4a90e2',
                fillColor: '#4a90e2',
                fillOpacity: 0.5,
                weight: 2
              });

              selectedRegion = layer;
            });

            layer.bindTooltip(region); // íˆ´íŒ í‘œì‹œ
          }
        }).addTo(map);
        // âœ… ì—¬ê¸° ì•„ë˜ì— ë„£ìœ¼ë©´ ì™„ë²½!
        map.on('zoomend', function () {
          const zoom = map.getZoom();
          if (zoom < 10) {
            document.querySelectorAll('.leaflet-interactive').forEach(el => {
              el.classList.remove('hide-circle');
            });
          }
        });
      });


    // ì¹´ë“œ ë Œë” í•¨ìˆ˜ ìˆ˜ì •
    function showCompanies(region) {
      let selectedMarker = null;
      const cardsEl = document.getElementById('cards');
      const searchText = document.getElementById('search-input').value.toLowerCase();
      const selectedIndustry = document.getElementById('industry-filter').value;

      cardsEl.innerHTML = '';
      document.getElementById('history-list').innerHTML = '';
      selectedCard = null;

      const filtered = companies.filter(c =>
        c.region === region &&
        c.name.toLowerCase().includes(searchText) &&
        (selectedIndustry === '' || c.industry === selectedIndustry)
      );

      filtered.forEach(c => {
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `<h4>${c.name}</h4><small>${c.industry} | ${c.contact}</small><br/><small>${c.address}</small>`;
        card.onclick = () => {
          showActivities(c.id);
          if (selectedCard) selectedCard.classList.remove('active');
          card.classList.add('active');
          selectedCard = card;

          // âœ… ì› ìˆ¨ê¸°ê¸°
          document.querySelectorAll('.leaflet-interactive').forEach(el => {
            el.classList.add('hide-circle');
          });

          // âœ… ì§€ë„ ì´ë™
          map.flyTo([c.lat, c.lng], 18, {
            duration: 1.5
          });
          // âœ… ê¸°ì¡´ ë§ˆì»¤ ì œê±°
          if (selectedMarker) {
            map.removeLayer(selectedMarker);
          }

          // âœ… ìƒˆ ë§ˆì»¤ ì¶”ê°€ (ì• ë‹ˆë©”ì´ì…˜ í¬í•¨)
          selectedMarker = L.marker([c.lat, c.lng], {
            icon: L.divIcon({
              className: 'custom-marker',
              html: `<div class="marker-dot marker-bounce"></div>`,
              iconSize: [20, 20],
              iconAnchor: [10, 10]
            })
          }).addTo(map);

        };
        cardsEl.appendChild(card);
      });
    }

    // ê²€ìƒ‰/í•„í„° ì…ë ¥ ì´ë²¤íŠ¸
    document.getElementById('search-input').addEventListener('input', () => {
      if (selectedCircle) selectedCircle.fire('click');
    });

    document.getElementById('industry-filter').addEventListener('change', () => {
      if (selectedCircle) selectedCircle.fire('click');
    });

    document.addEventListener('keydown', function (e) {
      if (e.key === 'Escape') {
        map.flyTo([36.5, 127.5], 7, { duration: 1.5 });
        // document.getElementById('reset-view').style.display = 'none';
      }
    });



    function showActivities(companyId) {
      const historyEl = document.getElementById('history-list');
      historyEl.innerHTML = '';
      const logs = activities[companyId] || [];
      logs.forEach(({ date, type, content }) => {
        const li = document.createElement('li');
        li.innerHTML = `<strong>${date}</strong> <span style="background:#e0f0ff; color:#0077cc; border-radius:4px; padding:2px 6px; margin-right:4px;">${type}</span> ${content}`;
        historyEl.appendChild(li);
      });
    }

  </script>
</body>

</html>